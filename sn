--[[
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘         PS99 HUGE PET SNIPER PRO V4.1 (SERVER HOP)           â•‘
    â•‘  Full original script + smart server hopping added          â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]--

repeat task.wait() until game:IsLoaded()
repeat task.wait() until game.Players.LocalPlayer

if _G.HUGE_SNIPER_LOADED then
    return warn("âš ï¸ Huge Sniper already running!")
end
_G.HUGE_SNIPER_LOADED = true

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SERVICES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualUser = game:GetService("VirtualUser")
local StarterGui = game:GetService("StarterGui")
local TeleportService = game:GetService("TeleportService") -- [SERVER HOP]

local plr = Players.LocalPlayer
local Network = ReplicatedStorage:WaitForChild("Network")

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- CONFIG
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local CONFIG = {
    Enabled = true,
    MaxPrice = 20000000,

    OnlyHuge = true,
    IgnoreTitanic = false,

    WebhookURL = "https://discord.com/api/webhooks/1440202664389640242/RR2NiQ4WqbtRy4zH9YmmQcdW4YgPCqz22HCBnW-XVd0nNvH1WklGYX_eDjoyQyF8ruoU",
    NotifyOnPurchase = true,
    NotifyOnStart = true,
    NotifySessionStats = true,
    StatsInterval = 600,

    ScanInterval = 0.25,
    MaxBoothsPerScan = 100,

    SmartGemReserve = true,
    ReserveAmount = 500000,

    -- [SERVER HOP]
    ServerHop = false,
    MaxNoHugeScans = 120,
    HopCooldown = 10,

    BlacklistSellers = {},
    BlacklistPets = {}
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SESSION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local Session = {
    StartTime = os.time(),
    StartGems = 0,
    CurrentGems = 0,

    TotalScans = 0,
    BoothsScanned = 0,
    HugesSeen = 0,
    HugesBought = 0,
    FailedPurchases = 0,
    TotalSpent = 0,

    NoHugeScans = 0, -- [SERVER HOP]

    MostExpensive = {price = 0, name = "None"},
    CheapestHuge = {price = math.huge, name = "None"},

    PurchaseHistory = {},
    PetsBought = {}
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- UTILITIES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function formatNumber(num)
    if num >= 1e9 then return string.format("%.2fB", num/1e9)
    elseif num >= 1e6 then return string.format("%.2fM", num/1e6)
    elseif num >= 1e3 then return string.format("%.2fK", num/1e3)
    end
    return tostring(math.floor(num))
end

local function formatTime(sec)
    local h = math.floor(sec/3600)
    local m = math.floor((sec%3600)/60)
    local s = sec%60
    if h > 0 then return h.."h "..m.."m"
    elseif m > 0 then return m.."m "..s.."s"
    end
    return s.."s"
end

local function log(t, m)
    print("["..t.."] "..m)
end

local function notify(t, m)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = t,
            Text = m,
            Duration = 4
        })
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SAVE / GEMS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function getSave()
    local ok, data = pcall(function()
        return require(ReplicatedStorage.Library.Client.Save).Get()
    end)
    return ok and data
end

local function getGems()
    local save = getSave()
    if not save then return 0 end
    for _, c in pairs(save.Inventory.Currency) do
        if c.id == "Diamonds" then
            return c._am or 0
        end
    end
    return 0
end

local function updateGems()
    Session.CurrentGems = getGems()
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- WEBHOOK
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local lastWebhook = 0
local function sendWebhook(payload)
    if CONFIG.WebhookURL == "" then return end
    if os.time() - lastWebhook < 2 then return end
    lastWebhook = os.time()

    task.spawn(function()
        pcall(function()
            request({
                Url = CONFIG.WebhookURL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(payload)
            })
        end)
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- [SERVER HOP]
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local hopping = false
local function serverHop()
    if hopping then return end
    hopping = true

    log("HOP", "No huges found â€” hopping server")

    sendWebhook({
        embeds = {{
            title = "ğŸ”„ Server Hop",
            description = "No huges found in this server",
            color = 0xFFA500,
            fields = {
                {name="Scans", value=tostring(Session.TotalScans), inline=true},
                {name="Runtime", value=formatTime(os.time()-Session.StartTime), inline=true}
            },
            timestamp = os.date("!%Y-%m-%dT%H:%M:%S")
        }}
    })

    task.wait(CONFIG.HopCooldown)
    TeleportService:Teleport(game.PlaceId, plr)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PURCHASE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local purchaseLock = false
local function purchaseHuge(boothUID, listingUID, name, price, amount)
    if purchaseLock then return end
    purchaseLock = true

    local ok, res = pcall(function()
        return Network["Booths_Purchase"]:InvokeServer(boothUID, listingUID)
    end)

    purchaseLock = false

    if ok and res then
        Session.HugesBought += amount
        Session.TotalSpent += price
        Session.NoHugeScans = 0 -- [SERVER HOP RESET]

        table.insert(Session.PurchaseHistory, {
            name = name,
            price = price,
            amount = amount,
            time = os.time()
        })

        updateGems()
        notify("HUGE SNIPED", name.." - "..formatNumber(price))
    else
        Session.FailedPurchases += 1
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SCAN BOOTH
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function scanBooth(booth)
    if not booth:GetAttribute("OwnerUID") then return end

    local uid = booth:GetAttribute("OwnerUID")
    local ok, data = pcall(function()
        return Network["Booths_RequestGet"]:InvokeServer(uid)
    end)
    if not ok or not data or not data.Listings then return end

    Session.BoothsScanned += 1

    for id, listing in pairs(data.Listings) do
        local price = listing.DiamondCost
        local item = listing.ItemData
        if not item or not price then continue end

        local name = item.id
        local amount = item._am or 1

        if not name:lower():find("huge") then continue end
        if CONFIG.IgnoreTitanic and name:lower():find("titanic") then continue end
        if price > CONFIG.MaxPrice then continue end

        Session.HugesSeen += 1

        if CONFIG.SmartGemReserve and (Session.CurrentGems - price < CONFIG.ReserveAmount) then continue end
        if Session.CurrentGems < price then continue end

        purchaseHuge(uid, id, name, price, amount)
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN LOOP
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
local function mainLoop()
    notify("Sniper Started", "Scanning booths...")

    while CONFIG.Enabled do
        task.wait(CONFIG.ScanInterval + math.random()*0.1)

        Session.TotalScans += 1
        Session.NoHugeScans += 1

        if CONFIG.ServerHop and Session.NoHugeScans >= CONFIG.MaxNoHugeScans then
            serverHop()
            break
        end

        local booths = Workspace:FindFirstChild("__THINGS")
        booths = booths and booths:FindFirstChild("__REMOTES")
        booths = booths and booths:FindFirstChild("Booths")
        if not booths then continue end

        for i, booth in ipairs(booths:GetChildren()) do
            if i > CONFIG.MaxBoothsPerScan then break end
            pcall(scanBooth, booth)
        end

        updateGems()
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ANTI AFK
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
pcall(function()
    plr.PlayerScripts.Scripts.Core["Idle Tracking"].Enabled = false
end)

if getconnections then
    for _, c in pairs(getconnections(plr.Idled)) do
        pcall(function() c:Disable() end)
    end
end

task.spawn(function()
    while task.wait(600) do
        VirtualUser:Button2Down(Vector2.new(), workspace.CurrentCamera.CFrame)
        task.wait(1)
        VirtualUser:Button2Up(Vector2.new(), workspace.CurrentCamera.CFrame)
    end
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- START
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Session.StartGems = getGems()
Session.CurrentGems = Session.StartGems

mainLoop()
