--[[
    Christmas Egg Hatcher - Exact Method
    Uses griffin's exact hatching code
]]--

-- Wait for game to load
repeat task.wait() until game:IsLoaded()

-- Services
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local Network = ReplicatedStorage.Network

-- Helper functions (EXACT from griffin's code)
local function Invoke(name, args)
    if Network:FindFirstChild(name) then
        return Network[name]:InvokeServer(unpack(args))
    else
        warn("Network."..name.." doesn't exist")
        return nil
    end
end

local function clickPosition(x, y)
    VirtualUser:Button1Down(Vector2.new(x, y))
    VirtualUser:Button1Up(Vector2.new(x, y))
end

-- Christmas eggs configuration
local christmasEggs = {
    "1 | Candy Cane Egg",
    "2 | Icy Egg",
    "4 | Pine Tree Egg"
}

-- Settings
local HATCH_AMOUNT = 36  -- Change to 3 or 8
local WAIT_BETWEEN_HATCHES = 0.75  -- Griffin uses 0.75 seconds

print("===========================================")
print("ðŸŽ„ Christmas Egg Hatcher - Griffin Method ðŸŽ„")
print("===========================================")
print("Eggs:", table.concat(christmasEggs, ", "))
print("Hatch Amount:", HATCH_AMOUNT)
print("===========================================\n")

local currentEggIndex = 1
local successfulHatches = 0
local farmEggsDebounce = false

-- Main hatching function (EXACT from griffin's farmEggs function)
local function farmEggs(selectedEgg, openAmount)
    if not farmEggsDebounce then
        farmEggsDebounce = true
        
        print("[ATTEMPT] Hatching:", selectedEgg, "x", openAmount)
        
        -- Split the egg name (EXACT from griffin's code)
        local splitName = string.split(selectedEgg, " | ")
        local eggName = splitName[2]  -- Get the name part
        
        print("[DEBUG] Egg name:", eggName)
        print("[DEBUG] Calling Eggs_RequestPurchase...")
        
        -- Call the exact same way griffin does
        local success, result = pcall(function()
            Invoke("Eggs_RequestPurchase", {eggName, openAmount})
        end)
        
        if not success then
            warn("[ERROR] Invoke failed:", result)
            farmEggsDebounce = false
            return false
        end
        
        print("[OK] Request sent successfully")
        
        -- Wait a bit (griffin uses 0.4)
        task.wait(0.4)
        
        -- Click to skip animation (EXACT from griffin's code)
        print("[SKIP] Waiting for eggs and clicking...")
        repeat
            task.wait()
            clickPosition(math.huge, math.huge)
        until not Workspace.Camera:FindFirstChild("Eggs")
        
        print("[SUCCESS] âœ… Hatched successfully!\n")
        
        -- Wait like griffin does
        task.wait(0.75)
        farmEggsDebounce = false
        
        return true
    end
    return false
end

-- Main loop
while task.wait(WAIT_BETWEEN_HATCHES) do
    -- Safety check
    if not LocalPlayer or not LocalPlayer.Character then
        warn("Player disconnected, stopping...")
        break
    end
    
    -- Get current egg
    local selectedEgg = christmasEggs[currentEggIndex]
    
    -- Try to hatch
    local success = farmEggs(selectedEgg, HATCH_AMOUNT)
    
    if success then
        successfulHatches = successfulHatches + 1
        print(string.format("ðŸ“Š Total Hatches: %d", successfulHatches))
    else
        warn("[SKIP] Moving to next egg...")
    end
    
    -- Rotate to next egg
    currentEggIndex = currentEggIndex + 1
    if currentEggIndex > #christmasEggs then
        currentEggIndex = 1
    end
end

print("\n===========================================")
print("ðŸŽ„ Hatcher Stopped ðŸŽ„")
print(string.format("Total Successful Hatches: %d", successfulHatches))
print("===========================================")
