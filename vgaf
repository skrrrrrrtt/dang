--[[
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ZONE SCANNER & EVENT DETECTOR V1.0
    
    Scans your best area for:
    âœ… Active events
    âœ… Active boosts
    âœ… Breakables (coins, chests, special items)
    âœ… Current buffs
    âœ… Zone-specific activities
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
]]--

local VERSION = "1.0.0"

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- LOGGING
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function log(...)
    print("[Zone Scanner]", ...)
end

local function header(text)
    log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    log("â•‘  " .. text)
    log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
end

local function section(text)
    log("")
    log("â–¼ " .. text)
    log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- SERVICES & SETUP
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local cloneref = cloneref or function(obj) return obj end

local Workspace = cloneref(game:GetService("Workspace"))
local Players = cloneref(game:GetService("Players"))
local ReplicatedStorage = cloneref(game:GetService("ReplicatedStorage"))
local Lighting = cloneref(game:GetService("Lighting"))

local LocalPlayer = Players.LocalPlayer

header("ZONE SCANNER V" .. VERSION)
log("Initializing...")

-- Safe require function
local function safeRequire(module)
    local success, result = pcall(require, module)
    return success and result or nil
end

-- Get game objects
local Things = Workspace:FindFirstChild("__THINGS")
if not Things then
    error("Game not fully loaded! Please wait.")
end

local Breakables = Things:FindFirstChild("Breakables")
local Orbs = Things:FindFirstChild("Orbs")
local Lootbags = Things:FindFirstChild("Lootbags")
local Instances = Things:FindFirstChild("Instances")

-- Load game modules
local Library = ReplicatedStorage:FindFirstChild("Library")
local Client = Library and safeRequire(Library.Client)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- PLAYER INFO FUNCTIONS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function getPlayerSave()
    if not Client or not Client.Save then return {} end
    local success, saves = pcall(Client.Save.GetSaves)
    if not success or not saves then return {} end
    return saves[LocalPlayer] or {}
end

local function getMaxZone()
    if not Client or not Client.WorldCmds then return "Unknown" end
    
    local success, zones = pcall(Client.WorldCmds.GetUnlockedZones)
    if not success or not zones or #zones == 0 then
        return "Spawn"
    end
    
    local maxZone = zones[1]
    for _, zone in ipairs(zones) do
        if zone.ZoneNumber > maxZone.ZoneNumber then
            maxZone = zone
        end
    end
    return maxZone.Name
end

local function getUnlockedZones()
    if not Client or not Client.WorldCmds then return {} end
    
    local success, zones = pcall(Client.WorldCmds.GetUnlockedZones)
    if not success then return {} end
    return zones or {}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- BOOST SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanBoosts()
    section("ACTIVE BOOSTS")
    
    local save = getPlayerSave()
    local boosts = save.Boosts or {}
    
    local activeBoosts = {}
    local currentTime = os.time()
    
    for boostType, boostData in pairs(boosts) do
        if typeof(boostData) == "table" then
            local expiresAt = boostData._am or 0
            
            if expiresAt > currentTime then
                local timeLeft = expiresAt - currentTime
                local minutes = math.floor(timeLeft / 60)
                local seconds = timeLeft % 60
                
                table.insert(activeBoosts, {
                    name = boostType,
                    multiplier = boostData._mul or 1,
                    timeLeft = string.format("%dm %ds", minutes, seconds)
                })
            end
        end
    end
    
    if #activeBoosts > 0 then
        for _, boost in ipairs(activeBoosts) do
            log(string.format("  âœ“ %s | x%.1f | %s", 
                boost.name, boost.multiplier, boost.timeLeft))
        end
    else
        log("  âœ— No active boosts")
    end
    
    return activeBoosts
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- BREAKABLES SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanBreakables()
    section("BREAKABLES IN WORLD")
    
    if not Breakables then
        log("  âœ— Breakables not found")
        return {}
    end
    
    local breakableTypes = {}
    local totalCount = 0
    
    for _, breakable in ipairs(Breakables:GetChildren()) do
        totalCount = totalCount + 1
        
        -- Categorize breakables
        local name = breakable.Name:lower()
        local category = "Other"
        
        if name:find("coin") or name:find("jar") then
            category = "Coin Jars"
        elseif name:find("chest") or name:find("superior") then
            category = "Chests"
        elseif name:find("comet") then
            category = "Comets"
        elseif name:find("pinata") then
            category = "Pinatas"
        elseif name:find("luckyblock") or name:find("lucky") then
            category = "Lucky Blocks"
        elseif name:find("safe") then
            category = "Safes"
        elseif name:find("vault") then
            category = "Vaults"
        end
        
        breakableTypes[category] = (breakableTypes[category] or 0) + 1
    end
    
    log(string.format("  Total Breakables: %d", totalCount))
    log("")
    
    for category, count in pairs(breakableTypes) do
        log(string.format("    â€¢ %s: %d", category, count))
    end
    
    return breakableTypes
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- COLLECTIBLES SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanCollectibles()
    section("COLLECTIBLES")
    
    local orbCount = Orbs and #Orbs:GetChildren() or 0
    local lootbagCount = Lootbags and #Lootbags:GetChildren() or 0
    
    log(string.format("  Orbs: %d", orbCount))
    log(string.format("  Lootbags: %d", lootbagCount))
    
    return {orbs = orbCount, lootbags = lootbagCount}
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- EVENT SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanEvents()
    section("ACTIVE EVENTS & SPECIAL ACTIVITIES")
    
    local events = {}
    
    -- Check for event folders in workspace
    local eventFolders = {
        "Halloween",
        "Christmas", 
        "Easter",
        "Summer",
        "Anniversary",
        "Special",
        "Event"
    }
    
    for _, eventName in ipairs(eventFolders) do
        if Workspace:FindFirstChild(eventName) then
            table.insert(events, eventName .. " Event Active")
            log(string.format("  ğŸ‰ %s Event Active!", eventName))
        end
    end
    
    -- Check Instances for active minigames/events
    if Instances then
        for _, instance in ipairs(Instances:GetChildren()) do
            local name = instance.Name
            if name:find("Event") or name:find("Special") or name:find("Halloween") or name:find("Christmas") then
                table.insert(events, name)
                log(string.format("  ğŸ® %s Available", name))
            end
        end
    end
    
    -- Check lighting for special effects
    local atmosphere = Lighting:FindFirstChildOfClass("Atmosphere")
    if atmosphere then
        log(string.format("  ğŸŒŸ Special Atmosphere Active"))
    end
    
    if #events == 0 then
        log("  âœ— No special events detected")
    end
    
    return events
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ZONE INFO SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanZoneInfo()
    section("ZONE INFORMATION")
    
    local maxZone = getMaxZone()
    local zones = getUnlockedZones()
    
    log(string.format("  Best Zone: %s", maxZone))
    log(string.format("  Total Zones Unlocked: %d", #zones))
    
    -- Check if in dotted box (zone area)
    if Client and Client.MapCmds then
        local inZone = pcall(Client.MapCmds.IsInDottedBox)
        if inZone then
            log("  ğŸ“ Currently in active zone")
        end
    end
    
    return maxZone
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- BUFF SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanBuffs()
    section("ACTIVE BUFFS & MULTIPLIERS")
    
    local save = getPlayerSave()
    local buffs = {}
    
    -- Check for various multipliers
    if save.DamageMultiplier and save.DamageMultiplier > 1 then
        table.insert(buffs, string.format("Damage: x%.1f", save.DamageMultiplier))
    end
    
    if save.CoinMultiplier and save.CoinMultiplier > 1 then
        table.insert(buffs, string.format("Coins: x%.1f", save.CoinMultiplier))
    end
    
    if save.LuckMultiplier and save.LuckMultiplier > 1 then
        table.insert(buffs, string.format("Luck: x%.1f", save.LuckMultiplier))
    end
    
    -- Check for VIP/Gamepasses
    if Client and Client.Gamepasses then
        local hasVIP = pcall(function()
            return Client.Gamepasses.Owns(257811346) -- VIP gamepass ID
        end)
        
        if hasVIP then
            table.insert(buffs, "VIP Active")
        end
    end
    
    if #buffs > 0 then
        for _, buff in ipairs(buffs) do
            log("  âœ“ " .. buff)
        end
    else
        log("  âœ— No special buffs active")
    end
    
    return buffs
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- INSTANCE SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanInstances()
    section("AVAILABLE INSTANCES")
    
    if not Instances then
        log("  âœ— Instances not found")
        return {}
    end
    
    local available = {}
    
    for _, instance in ipairs(Instances:GetChildren()) do
        local name = instance.Name
        local hasEnter = instance:FindFirstChild("Enter", true)
        
        if hasEnter then
            table.insert(available, name)
            log(string.format("  ğŸšª %s", name))
        end
    end
    
    if #available == 0 then
        log("  âœ— No instances available")
    end
    
    return available
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- QUESTS SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function scanQuests()
    section("ACTIVE QUESTS")
    
    local save = getPlayerSave()
    local goals = save.Goals or {}
    
    local questCount = 0
    local questTypes = {}
    
    for _, quest in pairs(goals) do
        if quest.Goal then
            questCount = questCount + 1
            local questType = quest.TypeAsString or "Unknown"
            local progress = quest.Goal.Progress or 0
            local amount = quest.Goal.Amount or 1
            local percentage = math.floor((progress / amount) * 100)
            
            questTypes[questType] = (questTypes[questType] or 0) + 1
            
            log(string.format("  ğŸ“‹ %s - %d%% complete", 
                quest.Title or "Unknown Quest", percentage))
        end
    end
    
    if questCount == 0 then
        log("  âœ— No active quests")
    else
        log("")
        log(string.format("  Total Quests: %d", questCount))
    end
    
    return questCount
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- MAIN SCAN FUNCTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function performFullScan()
    log("")
    log("Starting comprehensive scan...")
    log("")
    
    local results = {}
    
    -- Run all scans
    results.zone = scanZoneInfo()
    results.boosts = scanBoosts()
    results.buffs = scanBuffs()
    results.events = scanEvents()
    results.breakables = scanBreakables()
    results.collectibles = scanCollectibles()
    results.instances = scanInstances()
    results.quests = scanQuests()
    
    -- Summary
    log("")
    header("SCAN COMPLETE!")
    log("")
    log("Summary:")
    log(string.format("  â€¢ Best Zone: %s", results.zone))
    log(string.format("  â€¢ Active Boosts: %d", #results.boosts))
    log(string.format("  â€¢ Active Events: %d", #results.events))
    log(string.format("  â€¢ Total Breakables: %d", 
        results.breakables["Coin Jars"] or 0 + 
        results.breakables["Chests"] or 0 +
        results.breakables["Comets"] or 0))
    log(string.format("  â€¢ Active Quests: %d", results.quests))
    log("")
    
    return results
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- AUTO-UPDATE SCANNER
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

getgenv().zoneScanner = {
    scan = performFullScan,
    
    startAutoScan = function(interval)
        interval = interval or 60
        log("Starting auto-scan every " .. interval .. " seconds")
        
        getgenv().zoneScannerEnabled = true
        
        task.spawn(function()
            while getgenv().zoneScannerEnabled do
                performFullScan()
                log("")
                log("Next scan in " .. interval .. " seconds...")
                log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
                task.wait(interval)
            end
        end)
    end,
    
    stopAutoScan = function()
        getgenv().zoneScannerEnabled = false
        log("Auto-scan stopped")
    end,
    
    quickScan = function()
        log("Quick Scan:")
        log("  Zone:", getMaxZone())
        log("  Breakables:", Breakables and #Breakables:GetChildren() or 0)
        log("  Orbs:", Orbs and #Orbs:GetChildren() or 0)
        log("  Lootbags:", Lootbags and #Lootbags:GetChildren() or 0)
    end
}

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- RUN INITIAL SCAN
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

log("Scanner loaded!")
log("")
log("Commands:")
log("  getgenv().zoneScanner.scan()           - Full scan")
log("  getgenv().zoneScanner.quickScan()      - Quick scan")
log("  getgenv().zoneScanner.startAutoScan(60) - Auto scan every 60s")
log("  getgenv().zoneScanner.stopAutoScan()   - Stop auto scan")
log("")

-- Perform initial scan
task.wait(1)
performFullScan()

return getgenv().zoneScanner
