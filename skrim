-- PS99 CLEAN STATS HUD (WITH EGGS HATCHED)

repeat task.wait() until game:IsLoaded()

-- SERVICES
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer

-- Wait for player to be ready
repeat task.wait() until player
repeat task.wait() until not player.PlayerGui:FindFirstChild("__INTRO")

-- Get PlayerSave module
local PlayerSave = require(ReplicatedStorage.Library.Client.Save)

-- remove old gui
pcall(function()
    CoreGui:FindFirstChild("StatsOverlay"):Destroy()
end)

-- ================= GUI =================
local gui = Instance.new("ScreenGui")
gui.Name = "StatsOverlay"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = CoreGui

-- background
local bg = Instance.new("Frame")
bg.AnchorPoint = Vector2.new(0.5,0.5)
bg.Position = UDim2.fromScale(0.5,0.5)
bg.Size = UDim2.fromScale(2,2)
bg.BackgroundColor3 = Color3.new(0,0,0)
bg.BorderSizePixel = 0
bg.Parent = gui

-- container
local container = Instance.new("Frame")
container.AnchorPoint = Vector2.new(0.5,0.5)
container.Position = UDim2.fromScale(0.5,0.5)
container.Size = UDim2.fromOffset(520,350)  -- Made taller for eggs line
container.BackgroundTransparency = 1
container.Parent = bg

-- label helper
local function makeLabel(y, size)
    local t = Instance.new("TextLabel")
    t.Position = UDim2.fromOffset(0,y)
    t.Size = UDim2.new(1,0,0,size)
    t.BackgroundTransparency = 1
    t.Font = Enum.Font.GothamBold
    t.TextSize = size - 4
    t.TextColor3 = Color3.new(1,1,1)
    t.TextXAlignment = Enum.TextXAlignment.Center
    t.TextYAlignment = Enum.TextYAlignment.Center
    t.Parent = container
    return t
end

-- labels
local title = makeLabel(0,40)
title.Text = "STATS OVERLAY"
title.TextSize = 32

local playerLbl   = makeLabel(60,26)
local diamondsLbl = makeLabel(110,26)
local rateLbl     = makeLabel(140,22)
local eggsLbl     = makeLabel(170,26)  -- NEW: Eggs hatched line
local eggRateLbl  = makeLabel(200,22)  -- NEW: Eggs hatched rate
local timeLbl     = makeLabel(240,28)  -- Moved down

-- ================= BUTTONS =================
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.fromOffset(150,40)
closeBtn.Position = UDim2.fromScale(0.5,1)
closeBtn.AnchorPoint = Vector2.new(0.5,1)
closeBtn.Text = "CLOSE"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.BackgroundColor3 = Color3.fromRGB(220,20,60)
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Parent = container
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0,8)

local openBtn = Instance.new("TextButton")
openBtn.Size = UDim2.fromOffset(150,40)
openBtn.Position = UDim2.fromScale(0.5,0.9)
openBtn.AnchorPoint = Vector2.new(0.5,0.5)
openBtn.Text = "OPEN STATS"
openBtn.Font = Enum.Font.GothamBold
openBtn.TextSize = 18
openBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
openBtn.TextColor3 = Color3.new(1,1,1)
openBtn.Parent = gui
Instance.new("UICorner", openBtn).CornerRadius = UDim.new(0,8)

-- ================= VISIBILITY =================
local visible = true
local startTime = os.clock()

local function setVisible(v)
    visible = v
    bg.Visible = v
    openBtn.Visible = not v
end

closeBtn.MouseButton1Click:Connect(function()
    setVisible(false)
end)

openBtn.MouseButton1Click:Connect(function()
    setVisible(true)
end)

-- ================= HELPERS =================
local function fmt(n)
    if n >= 1e9 then return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n/1e3)
    end
    return tostring(math.floor(n))
end

local function fmtTime(t)
    return string.format(
        "%02d:%02d:%02d",
        math.floor(t/3600),
        math.floor(t%3600/60),
        math.floor(t%60)
    )
end

-- ================= EGGS HATCHED =================
local function getEggsHatched()
    local ok, data = pcall(function()
        return PlayerSave.Get()
    end)
    if not ok or type(data) ~= "table" then
        return nil
    end
    return tonumber(data.EggsHatched) or 0
end

local lastEggs = 0
local lastEggCheck = os.clock()
local eggRate = 0

-- ================= DIAMONDS =================
local diamondsStat
task.spawn(function()
    local ls = player:WaitForChild("leaderstats")
    diamondsStat =
        ls:FindFirstChild("üíé Diamonds")
        or ls:FindFirstChild("\240\159\146\142 Diamonds")
end)

local lastDiamonds = 0
local lastCheck = os.clock()
local diamondRate = 0

-- ================= UPDATE LOOP =================
RunService.RenderStepped:Connect(function()
    if not visible then return end

    playerLbl.Text = "PLAYER: " .. player.Name

    -- DIAMONDS
    if diamondsStat then
        local d = diamondsStat.Value
        diamondsLbl.Text = "üíé Diamonds: " .. fmt(d)

        if os.clock() - lastCheck >= 5 then
            diamondRate = (d - lastDiamonds) / ((os.clock() - lastCheck) / 60)
            lastDiamonds = d
            lastCheck = os.clock()
        end

        rateLbl.Text = "üíé Rate: +" .. fmt(math.max(diamondRate, 0)) .. " / min"
    end

    -- EGGS HATCHED
    local currentEggs = getEggsHatched()
    if currentEggs then
        eggsLbl.Text = "ü•ö Eggs Hatched: " .. fmt(currentEggs)

        -- Calculate rate every 5 seconds
        if os.clock() - lastEggCheck >= 5 then
            eggRate = (currentEggs - lastEggs) / ((os.clock() - lastEggCheck) / 60)
            lastEggs = currentEggs
            lastEggCheck = os.clock()
        end

        eggRateLbl.Text = "ü•ö Rate: +" .. fmt(math.max(eggRate, 0)) .. " / min"
    else
        eggsLbl.Text = "ü•ö Eggs Hatched: Loading..."
        eggRateLbl.Text = "ü•ö Rate: --"
    end

    -- TIME
    timeLbl.Text = "‚è± Time: " .. fmtTime(os.clock() - startTime)
end)

print("‚úÖ PS99 STATS HUD LOADED (WITH EGGS HATCHED)")
