-- BLOX FRUITS CLEAN STATS HUD

repeat task.wait() until game:IsLoaded()

-- SERVICES
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer

-- Wait for player to be ready
repeat task.wait() until player
repeat task.wait() until player.Character

-- Remove old GUI
pcall(function()
    CoreGui:FindFirstChild("BloxFruitsStatsOverlay"):Destroy()
end)

-- ================= GUI =================
local gui = Instance.new("ScreenGui")
gui.Name = "BloxFruitsStatsOverlay"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = CoreGui

-- Background
local bg = Instance.new("Frame")
bg.AnchorPoint = Vector2.new(0.5, 0.5)
bg.Position = UDim2.fromScale(0.5, 0.5)
bg.Size = UDim2.fromScale(2, 2)
bg.BackgroundColor3 = Color3.new(0, 0, 0)
bg.BorderSizePixel = 0
bg.Parent = gui

-- Container
local container = Instance.new("Frame")
container.AnchorPoint = Vector2.new(0.5, 0.5)
container.Position = UDim2.fromScale(0.5, 0.5)
container.Size = UDim2.fromOffset(550, 520)
container.BackgroundTransparency = 1
container.Parent = bg

-- Label Helper
local function makeLabel(y, size)
    local t = Instance.new("TextLabel")
    t.Position = UDim2.fromOffset(0, y)
    t.Size = UDim2.new(1, 0, 0, size)
    t.BackgroundTransparency = 1
    t.Font = Enum.Font.GothamBold
    t.TextSize = size - 4
    t.TextColor3 = Color3.new(1, 1, 1)
    t.TextXAlignment = Enum.TextXAlignment.Center
    t.TextYAlignment = Enum.TextYAlignment.Center
    t.Parent = container
    return t
end

-- Labels
local title = makeLabel(0, 40)
title.Text = "BLOX FRUITS STATS"
title.TextSize = 32

local playerLbl = makeLabel(60, 26)
local levelLbl = makeLabel(95, 26)
local beliLbl = makeLabel(130, 26)
local beliRateLbl = makeLabel(160, 22)
local fragmentsLbl = makeLabel(190, 26)
local fragmentRateLbl = makeLabel(220, 22)
local bountyLbl = makeLabel(250, 26)
local fruitLbl = makeLabel(285, 26)
local meleeLbl = makeLabel(320, 24)
local defenseLbl = makeLabel(345, 24)
local swordLbl = makeLabel(370, 24)
local gunLbl = makeLabel(395, 24)
local fruitStatLbl = makeLabel(420, 24)
local timeLbl = makeLabel(455, 28)

-- ================= BUTTONS =================
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.fromOffset(150, 40)
closeBtn.Position = UDim2.fromScale(0.5, 1)
closeBtn.AnchorPoint = Vector2.new(0.5, 1)
closeBtn.Text = "CLOSE"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.BackgroundColor3 = Color3.fromRGB(220, 20, 60)
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Parent = container
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 8)

local openBtn = Instance.new("TextButton")
openBtn.Size = UDim2.fromOffset(150, 40)
openBtn.Position = UDim2.fromScale(0.5, 0.9)
openBtn.AnchorPoint = Vector2.new(0.5, 0.5)
openBtn.Text = "OPEN STATS"
openBtn.Font = Enum.Font.GothamBold
openBtn.TextSize = 18
openBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
openBtn.TextColor3 = Color3.new(1, 1, 1)
openBtn.Parent = gui
Instance.new("UICorner", openBtn).CornerRadius = UDim.new(0, 8)

-- ================= VISIBILITY =================
local visible = true
local startTime = os.clock()

local function setVisible(v)
    visible = v
    bg.Visible = v
    openBtn.Visible = not v
end

closeBtn.MouseButton1Click:Connect(function()
    setVisible(false)
end)

openBtn.MouseButton1Click:Connect(function()
    setVisible(true)
end)

-- ================= HELPERS =================
local function fmt(n)
    if n >= 1e9 then return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n/1e3)
    end
    return tostring(math.floor(n))
end

local function fmtTime(t)
    return string.format(
        "%02d:%02d:%02d",
        math.floor(t/3600),
        math.floor(t%3600/60),
        math.floor(t%60)
    )
end

-- ================= DATA RETRIEVAL =================
local function getPlayerData()
    local data = {
        Level = 0,
        Beli = 0,
        Fragments = 0,
        Bounty = 0,
        DevilFruit = "None",
        Melee = 0,
        Defense = 0,
        Sword = 0,
        Gun = 0,
        Fruit = 0
    }
    
    -- Get Level
    pcall(function()
        local level = player.Data.Level.Value
        data.Level = level or 0
    end)
    
    -- Get Beli
    pcall(function()
        local beli = player.Data.Beli.Value
        data.Beli = beli or 0
    end)
    
    -- Get Fragments
    pcall(function()
        local fragments = player.Data.Fragments.Value
        data.Fragments = fragments or 0
    end)
    
    -- Get Bounty/Honor
    pcall(function()
        local bounty = player.leaderstats["Bounty/Honor"].Value
        data.Bounty = bounty or 0
    end)
    
    -- Get Devil Fruit
    pcall(function()
        local fruit = player.Data.DevilFruit.Value
        data.DevilFruit = fruit ~= "" and fruit or "None"
    end)
    
    -- Get Stats
    pcall(function()
        data.Melee = player.Data.Stats.Melee.Level.Value or 0
        data.Defense = player.Data.Stats.Defense.Level.Value or 0
        data.Sword = player.Data.Stats.Sword.Level.Value or 0
        data.Gun = player.Data.Stats.Gun.Level.Value or 0
        data.Fruit = player.Data.Stats["Demon Fruit"].Level.Value or 0
    end)
    
    return data
end

-- ================= RATE TRACKING =================
local lastBeli = 0
local lastBeliCheck = os.clock()
local beliRate = 0

local lastFragments = 0
local lastFragmentCheck = os.clock()
local fragmentRate = 0

-- ================= UPDATE LOOP =================
RunService.RenderStepped:Connect(function()
    if not visible then return end
    
    local data = getPlayerData()
    
    -- Player Info
    playerLbl.Text = "PLAYER: " .. player.Name
    levelLbl.Text = "â­ Level: " .. data.Level
    
    -- Beli
    beliLbl.Text = "ğŸ’° Beli: " .. fmt(data.Beli)
    
    if os.clock() - lastBeliCheck >= 5 then
        beliRate = (data.Beli - lastBeli) / ((os.clock() - lastBeliCheck) / 60)
        lastBeli = data.Beli
        lastBeliCheck = os.clock()
    end
    
    beliRateLbl.Text = "ğŸ’° Rate: +" .. fmt(math.max(beliRate, 0)) .. " / min"
    
    -- Fragments
    fragmentsLbl.Text = "ğŸ’ Fragments: " .. fmt(data.Fragments)
    
    if os.clock() - lastFragmentCheck >= 5 then
        fragmentRate = (data.Fragments - lastFragments) / ((os.clock() - lastFragmentCheck) / 60)
        lastFragments = data.Fragments
        lastFragmentCheck = os.clock()
    end
    
    fragmentRateLbl.Text = "ğŸ’ Rate: +" .. fmt(math.max(fragmentRate, 0)) .. " / min"
    
    -- Bounty/Honor
    bountyLbl.Text = "ğŸ† Bounty/Honor: " .. fmt(data.Bounty)
    
    -- Devil Fruit
    fruitLbl.Text = "ğŸ Devil Fruit: " .. data.DevilFruit
    
    -- Stats
    meleeLbl.Text = "ğŸ‘Š Melee: " .. fmt(data.Melee)
    defenseLbl.Text = "ğŸ›¡ï¸ Defense: " .. fmt(data.Defense)
    swordLbl.Text = "âš”ï¸ Sword: " .. fmt(data.Sword)
    gunLbl.Text = "ğŸ”« Gun: " .. fmt(data.Gun)
    fruitStatLbl.Text = "ğŸ‡ Fruit: " .. fmt(data.Fruit)
    
    -- Time
    timeLbl.Text = "â±ï¸ Time: " .. fmtTime(os.clock() - startTime)
end)

print("âœ… BLOX FRUITS STATS HUD LOADED")
