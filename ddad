-- PS99 FULLSCREEN STATS OVERLAY (FIXED)

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- remove old
pcall(function()
    CoreGui:FindFirstChild("StatsOverlay"):Destroy()
end)

-- ================= GUI =================
local gui = Instance.new("ScreenGui")
gui.Name = "StatsOverlay"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = CoreGui

-- BIG ASF BLACK BACKGROUND
local bg = Instance.new("Frame")
bg.AnchorPoint = Vector2.new(0.5,0.5)
bg.Position = UDim2.fromScale(0.5,0.5)
bg.Size = UDim2.fromScale(2,2)
bg.BackgroundColor3 = Color3.new(0,0,0)
bg.BorderSizePixel = 0
bg.Parent = gui

-- CONTAINER
local container = Instance.new("Frame")
container.AnchorPoint = Vector2.new(0.5,0.5)
container.Position = UDim2.fromScale(0.5,0.5)
container.Size = UDim2.fromOffset(450,320)
container.BackgroundTransparency = 1
container.Parent = bg

-- TITLE
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,50)
title.BackgroundTransparency = 1
title.Text = "STATS OVERLAY"
title.Font = Enum.Font.GothamBold
title.TextSize = 34
title.TextColor3 = Color3.new(1,1,1)
title.Parent = container

-- PLAYER
local playerText = Instance.new("TextLabel")
playerText.Position = UDim2.fromOffset(0,80)
playerText.Size = UDim2.new(1,0,0,30)
playerText.BackgroundTransparency = 1
playerText.Font = Enum.Font.GothamBold
playerText.TextSize = 24
playerText.TextColor3 = Color3.fromRGB(0,255,127)
playerText.Text = "Player: "..player.Name
playerText.Parent = container

-- DIAMONDS
local diamondsText = Instance.new("TextLabel")
diamondsText.Position = UDim2.fromOffset(0,140)
diamondsText.Size = UDim2.new(1,0,0,30)
diamondsText.BackgroundTransparency = 1
diamondsText.Font = Enum.Font.GothamBold
diamondsText.TextSize = 24
diamondsText.TextColor3 = Color3.fromRGB(0,191,255)
diamondsText.Text = "Diamonds: 0"
diamondsText.Parent = container

-- TIMER
local timerText = Instance.new("TextLabel")
timerText.Position = UDim2.fromOffset(0,200)
timerText.Size = UDim2.new(1,0,0,40)
timerText.BackgroundTransparency = 1
timerText.Font = Enum.Font.GothamBold
timerText.TextSize = 28
timerText.TextColor3 = Color3.fromRGB(255,215,0)
timerText.Parent = container

-- CLOSE BUTTON
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.fromOffset(150,40)
closeBtn.Position = UDim2.fromScale(0.5,1)
closeBtn.AnchorPoint = Vector2.new(0.5,1)
closeBtn.Text = "CLOSE"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.BackgroundColor3 = Color3.fromRGB(220,20,60)
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Parent = container
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0,8)

-- OPEN BUTTON (ALWAYS AVAILABLE)
local openBtn = Instance.new("TextButton")
openBtn.Size = UDim2.fromOffset(140,40)
openBtn.Position = UDim2.fromScale(0.5,0.9)
openBtn.AnchorPoint = Vector2.new(0.5,0.5)
openBtn.Text = "OPEN STATS"
openBtn.Font = Enum.Font.GothamBold
openBtn.TextSize = 18
openBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
openBtn.TextColor3 = Color3.new(1,1,1)
openBtn.Parent = gui
Instance.new("UICorner", openBtn).CornerRadius = UDim.new(0,8)

-- STATE
local visible = true
local startTime = os.clock()

local function setVisible(v)
    visible = v
    bg.Visible = v
    openBtn.Visible = not v
end

closeBtn.MouseButton1Click:Connect(function()
    setVisible(false)
end)

openBtn.MouseButton1Click:Connect(function()
    setVisible(true)
end)

-- FORMAT TIME
local function fmtTime(t)
    return string.format(
        "%02d:%02d:%02d",
        math.floor(t/3600),
        math.floor(t%3600/60),
        math.floor(t%60)
    )
end

-- LEADERSTATS DIAMONDS (ðŸ’Ž)
local diamondsValue

task.spawn(function()
    local ls = player:WaitForChild("leaderstats")
    diamondsValue =
        ls:FindFirstChild("ðŸ’Ž Diamonds")
        or ls:FindFirstChild("\240\159\146\142 Diamonds")
end)

-- UPDATE LOOP
RunService.RenderStepped:Connect(function()
    if not visible then return end

    if diamondsValue then
        diamondsText.Text = "Diamonds: "..diamondsValue.Value
    end

    timerText.Text = fmtTime(os.clock() - startTime)
end)

print("âœ… PS99 STATS OVERLAY FULLY FIXED")
