-- ================= CONFIG =================
local CONFIG = {
    AUTO_ROB = true,
    ROB_DELAY = 2, -- seconds between ATM attempts
    WEBHOOK_URL = "PUT_DISCORD_WEBHOOK_HERE",
    WEBHOOK_INTERVAL = 300, -- seconds (5 min)
    local DROP_OFF_TARGET = 20000 -- $20,000

}
-- =========================================
-- SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CollectionService = game:GetService("CollectionService")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local remotes = ReplicatedStorage:WaitForChild("Remotes")

-- REMOTES
local StartATM = remotes:WaitForChild("AttemptATMBustStart")
local FinishATM = remotes:WaitForChild("AttemptATMBustComplete")

-- CONFIG
local DROP_OFF_TARGET = 20000
local AUTO_ROB = false

-- DATA
local robbedThisRun = 0
local lastCash = 0

-- GET CASH
local function getCash()
    local stats = player:FindFirstChild("leaderstats")
    local cash = stats and stats:FindFirstChild("Cash")
    return cash and cash.Value or 0
end

lastCash = getCash()

-- FORMAT
local function format(n)
    return tostring(n):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
end

-- TELEPORT SAFE
local function teleport(cf)
    local char = player.Character
    if char and char.PrimaryPart then
        char.PrimaryPart.Velocity = Vector3.zero
        char:PivotTo(cf + Vector3.new(0,5,0))
    end
end

-- FIND ATM
local function getATM()
    for _, atm in pairs(CollectionService:GetTagged("CriminalATM")) do
        if atm:GetAttribute("State") ~= "Busted" then
            return atm
        end
    end
end

-- DROP OFF
local function deliverMoney()
    local drop = workspace.Game.Jobs.CriminalDropOffSpawners
        .CriminalDropOffSpawnerPermanent

    if not drop then return end

    teleport(drop.CFrame)
    task.wait(1)

    -- jump to trigger delivery
    local char = player.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end

    task.wait(3)
    robbedThisRun = 0
end

-- ROB ATM
local function robATM(atm)
    teleport(atm.WorldPivot)
    task.wait(0.5)

    StartATM:InvokeServer(atm)
    task.wait(2.5)
    FinishATM:InvokeServer(atm)

    task.wait(2)

    local now = getCash()
    local gained = now - lastCash
    lastCash = now

    if gained > 0 then
        robbedThisRun += gained
        statusLabel.Text = "Robbed: $" .. format(robbedThisRun)
    end

    if robbedThisRun >= DROP_OFF_TARGET then
        statusLabel.Text = "Delivering..."
        deliverMoney()
    end
end

-- ================= UI =================
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "ATM_UI"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromScale(0.25, 0.2)
frame.Position = UDim2.fromScale(0.37, 0.4)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.BorderSizePixel = 0

local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0,12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.fromScale(1,0.25)
title.BackgroundTransparency = 1
title.Text = "ATM Auto Rob"
title.TextColor3 = Color3.new(1,1,1)
title.Font = Enum.Font.GothamBold
title.TextScaled = true

statusLabel = Instance.new("TextLabel", frame)
statusLabel.Position = UDim2.fromScale(0,0.3)
statusLabel.Size = UDim2.fromScale(1,0.25)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Robbed: $0"
statusLabel.TextColor3 = Color3.fromRGB(0,255,100)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextScaled = true

local toggle = Instance.new("TextButton", frame)
toggle.Position = UDim2.fromScale(0.1,0.65)
toggle.Size = UDim2.fromScale(0.8,0.25)
toggle.Text = "START"
toggle.BackgroundColor3 = Color3.fromRGB(60,180,75)
toggle.TextColor3 = Color3.new(1,1,1)
toggle.Font = Enum.Font.GothamBold
toggle.TextScaled = true

Instance.new("UICorner", toggle).CornerRadius = UDim.new(0,8)

toggle.MouseButton1Click:Connect(function()
    AUTO_ROB = not AUTO_ROB
    toggle.Text = AUTO_ROB and "STOP" or "START"
    toggle.BackgroundColor3 = AUTO_ROB and Color3.fromRGB(200,70,70) or Color3.fromRGB(60,180,75)
end)

-- MAIN LOOP
task.spawn(function()
    while task.wait(1) do
        if AUTO_ROB then
            local atm = getATM()
            if atm then
                robATM(atm)
            end
        end
    end
end)
