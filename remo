-- ATM Teleport Script for Roblox
-- Finds ATMs in workspace and teleports player near one

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Function to find all ATMs in workspace
local function findATMs()
    local atms = {}
    
    -- Search for ATM models/parts
    for _, descendant in pairs(Workspace:GetDescendants()) do
        local name = descendant.Name:lower()
        
        -- Check if it's an ATM (common names: "ATM", "BankATM", "CashMachine", etc.)
        if name:find("atm") or name:find("cash") and descendant:IsA("Model") or descendant:IsA("Part") then
            -- Make sure it has a valid position
            if descendant:IsA("Model") and descendant.PrimaryPart then
                table.insert(atms, descendant.PrimaryPart)
            elseif descendant:IsA("Part") or descendant:IsA("MeshPart") then
                table.insert(atms, descendant)
            end
        end
    end
    
    return atms
end

-- Function to teleport to nearest ATM
local function teleportToATM()
    local atms = findATMs()
    
    if #atms == 0 then
        warn("No ATMs found in workspace!")
        print("Searching in common locations...")
        
        -- Try to find in Buildings folder
        local buildings = Workspace:FindFirstChild("Buildings") or Workspace:FindFirstChild("Map")
        if buildings then
            for _, building in pairs(buildings:GetDescendants()) do
                if building.Name:lower():find("atm") then
                    table.insert(atms, building)
                end
            end
        end
    end
    
    if #atms == 0 then
        warn("Still no ATMs found! Listing all potential locations:")
        for _, obj in pairs(Workspace:GetChildren()) do
            print(" - " .. obj.Name)
        end
        return
    end
    
    -- Find closest ATM
    local closestATM = nil
    local closestDistance = math.huge
    
    for _, atm in pairs(atms) do
        local distance = (humanoidRootPart.Position - atm.Position).Magnitude
        if distance < closestDistance then
            closestDistance = distance
            closestATM = atm
        end
    end
    
    if closestATM then
        print("Found ATM at:", closestATM:GetFullName())
        print("Distance:", math.floor(closestDistance), "studs")
        
        -- Teleport slightly in front of the ATM (5 studs away)
        local atmPosition = closestATM.Position
        local offset = closestATM.CFrame.LookVector * -5 -- 5 studs in front
        local teleportPosition = atmPosition + offset + Vector3.new(0, 3, 0) -- Slightly elevated
        
        -- Method 1: Direct CFrame teleport (works in most games)
        humanoidRootPart.CFrame = CFrame.new(teleportPosition)
        print("Teleported to ATM!")
        
        -- Method 2: Try using game's teleport remote if method 1 doesn't work
        task.wait(0.1)
        local teleportRemote = ReplicatedStorage:FindFirstChild("Remotes") 
            and ReplicatedStorage.Remotes:FindFirstChild("Teleport")
        
        if teleportRemote then
            print("Using game's teleport system...")
            teleportRemote:FireServer(CFrame.new(teleportPosition))
        end
        
        return true
    else
        warn("No valid ATM found!")
        return false
    end
end

-- Function to list all ATMs
local function listAllATMs()
    local atms = findATMs()
    print("\n=== ATMs Found ===")
    print("Total ATMs:", #atms)
    for i, atm in pairs(atms) do
        print(i .. ". " .. atm:GetFullName())
        print("   Position:", atm.Position)
    end
    print("==================\n")
end

-- Execute
print("=== ATM Teleport Script ===")
listAllATMs()
task.wait(0.5)
teleportToATM()

-- Optional: Create a loop to keep teleporting (uncomment if needed)
--[[
while true do
    task.wait(5) -- Wait 5 seconds between teleports
    teleportToATM()
end
--]]
