--[[ 
    PS99 SELF MONITOR (PET + DIAMONDS ONLY)
    Delta Executor Compatible
]]

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- ================= CONFIG =================

local WEBHOOK_URL = "https://discord.com/api/webhooks/1414550206531244133/CRQ7-hTnGaBnu-v-yAGxOQYg07hdOZ2d93xfv6-PBTsSU5g3iqoV7_mkZSzoYKdBn1F1"
local UPDATE_INTERVAL = 300 -- 5 minutes
local TARGET_PET = "Merry Mule"

-- ================= HTTP =================

local function sendHttp(url, body)
    if http_request then
        return http_request({
            Url = url,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = body
        })
    elseif request then
        return request({
            Url = url,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = body
        })
    elseif syn and syn.request then
        return syn.request({
            Url = url,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = body
        })
    end
end

-- ================= DIAMONDS TRACK =================

local diamondsStat
task.spawn(function()
    local ls = LocalPlayer:WaitForChild("leaderstats")
    diamondsStat =
        ls:FindFirstChild("üíé Diamonds")
        or ls:FindFirstChild("\240\159\146\142 Diamonds")
end)

local lastDiamonds = 0
local lastCheck = os.clock()
local diamondRate = 0

local function updateDiamondRate()
    if not diamondsStat then return end
    local now = os.clock()
    local diff = diamondsStat.Value - lastDiamonds
    local timeDiff = now - lastCheck

    if timeDiff > 0 then
        diamondRate = math.floor((diff / timeDiff) * 60)
    end

    lastDiamonds = diamondsStat.Value
    lastCheck = now
end

-- ================= PET MONITOR =================

local function countMerryMule()
    local counts = {
        Normal = 0,
        Golden = 0,
        Rainbow = 0,
        Shiny = 0
    }

    local petsFolder = LocalPlayer:FindFirstChild("Pets")
    if not petsFolder then return counts end

    for _, pet in pairs(petsFolder:GetChildren()) do
        if pet.Name == TARGET_PET then
            local petType = "Normal"

            if pet:FindFirstChild("Shiny") and pet.Shiny.Value then
                petType = "Shiny"
            elseif pet:FindFirstChild("Rainbow") and pet.Rainbow.Value then
                petType = "Rainbow"
            elseif pet:FindFirstChild("Golden") and pet.Golden.Value then
                petType = "Golden"
            end

            counts[petType] += 1
        end
    end

    return counts
end

-- ================= WEBHOOK =================

local function sendWebhook()
    updateDiamondRate()

    local petCount = countMerryMule()

    local embed = {
        title = "üêæ PS99 Pet Monitor",
        description = "**" .. LocalPlayer.Name .. "**",
        color = 65280,
        fields = {
            {
                name = "üíé Diamonds",
                value = string.format(
                    "%s\n(+%s / min)",
                    diamondsStat and diamondsStat.Value or 0,
                    diamondRate
                ),
                inline = false
            },
            {
                name = "üéÅ Merry Mule",
                value =
                    "Normal: " .. petCount.Normal ..
                    "\nGolden: " .. petCount.Golden ..
                    "\nRainbow: " .. petCount.Rainbow ..
                    "\nShiny: " .. petCount.Shiny,
                inline = false
            }
        },
        footer = { text = "PS99 Monitor ‚Ä¢ Delta" },
        timestamp = DateTime.now():ToIsoDate()
    }

    sendHttp(WEBHOOK_URL, HttpService:JSONEncode({
        embeds = { embed }
    }))
end

-- ================= LOOP =================

task.spawn(function()
    while true do
        sendWebhook()
        task.wait(UPDATE_INTERVAL)
    end
end)

print("‚úÖ PS99 Pet + Diamond Monitor Started")
