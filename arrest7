--// AUTO ARREST CRIMINAL (REAL WORKING VERSION)
repeat task.wait() until game:IsLoaded()

if game.PlaceId ~= 3351674303 then
    warn("Wrong game")
    return
end

--// SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

--// REMOTES (Driving Empire)
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local ArrestRemote = Remotes:WaitForChild("Arrest")

--// STATE
local AutoArrest = false

--// SETTINGS
local Settings = {
    Offset = CFrame.new(0, 0, -4),
    UpdateRate = 0.25
}

--// UTILS
local function getHRP(char)
    return char and char:FindFirstChild("HumanoidRootPart")
end

local function isCriminal(plr)
    if not plr.Team then return false end
    local t = plr.Team.Name:lower()
    return t:find("criminal") or t:find("wanted") or t:find("prisoner")
end

local function getClosestCriminal()
    local myHRP = getHRP(LocalPlayer.Character)
    if not myHRP then return nil end

    local closest, dist = nil, math.huge

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and isCriminal(plr) and plr.Character then
            local hrp = getHRP(plr.Character)
            if hrp then
                local d = (myHRP.Position - hrp.Position).Magnitude
                if d < dist then
                    dist = d
                    closest = plr
                end
            end
        end
    end

    return closest
end

--// MAIN LOOP (THIS IS WHAT ACTUALLY DOES THE WORK)
task.spawn(function()
    while task.wait(Settings.UpdateRate) do
        if not AutoArrest then continue end

        pcall(function()
            local target = getClosestCriminal()
            if not target then return end

            local myHRP = getHRP(LocalPlayer.Character)
            local targetHRP = getHRP(target.Character)
            if not myHRP or not targetHRP then return end

            -- TP behind criminal
            myHRP.CFrame = targetHRP.CFrame * Settings.Offset
            task.wait(0.05)

            -- FIRE ARREST REMOTE
            ArrestRemote:FireServer(target)
        end)
    end
end)

--// LOAD WINDUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

--// UI
local Window = WindUI:CreateWindow({
    Title = "Auto Arrest Criminal",
    SubTitle = "Working Version",
    Icon = "shield",
    Folder = "AutoArrest",
    Size = UDim2.fromOffset(500, 350),
    Transparent = true,
    Theme = "Dark"
})

Window:SetToggleKey(Enum.KeyCode.G)

local Main = Window:Tab({
    Title = "Main",
    Icon = "shield"
})

Main:Toggle({
    Title = "ðŸš” Auto Arrest Criminals",
    Default = false,
    Callback = function(v)
        AutoArrest = v

        WindUI:Notify({
            Title = "Auto Arrest",
            Content = v and "ENABLED" or "DISABLED",
            Duration = 3
        })
    end
})

WindUI:Notify({
    Title = "Loaded",
    Content = "Auto Arrest Ready",
    Duration = 4
})

print("âœ… AUTO ARREST LOADED (WORKING)")
