--// AUTO ARREST CRIMINAL - ADVANCED WINDUI
repeat task.wait() until game:IsLoaded()

if game.PlaceId ~= 3351674303 then
    warn("Wrong game")
    return
end

--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

--// GLOBAL SETTINGS
_G.AutoArrestSettings = {
    UpdateRate = 0.12,
    Offset = Vector3.new(0, -3, 0),
    MaxDistance = 5000
}

--// FEATURE TOGGLES
local Features = {
    Master = false,
    AutoTarget = true,
    Follow = true,
    SmartSwitch = true,
    SafeMode = true
}

--// STATS
local Stats = {
    Arrests = 0,
    Target = "None",
    Criminals = 0
}

--// UTILS
local function getRoot(char)
    return char and char:FindFirstChild("HumanoidRootPart")
end

local function isCriminal(plr)
    if not plr.Team then return false end
    local t = plr.Team.Name:lower()
    return t:find("criminal") or t:find("wanted") or t:find("prisoner")
end

local function getNearestCriminal()
    local myRoot = getRoot(LocalPlayer.Character)
    if not myRoot then return nil end

    local closest, dist = nil, math.huge
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and getRoot(p.Character) and isCriminal(p) then
            local d = (getRoot(p.Character).Position - myRoot.Position).Magnitude
            if d < dist and d < _G.AutoArrestSettings.MaxDistance then
                closest, dist = p, d
            end
        end
    end
    return closest
end

local function followTarget(target)
    if not target or not target.Character then return end
    local tRoot = getRoot(target.Character)
    local myRoot = getRoot(LocalPlayer.Character)
    if not tRoot or not myRoot then return end

    if Features.SafeMode then
        myRoot.AssemblyLinearVelocity = Vector3.zero
    end

    myRoot.CFrame = tRoot.CFrame * CFrame.new(_G.AutoArrestSettings.Offset)
end

local function isArrested(plr)
    return not isCriminal(plr)
end

--// LOAD WINDUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

--// WINDOW
local Window = WindUI:CreateWindow({
    Title = "Auto Arrest Criminal",
    Icon = "shield",
    Author = "Advanced",
    Folder = "AutoArrest",
    Size = UDim2.fromOffset(600, 480),
    Transparent = true,
    Theme = "Dark"
})

Window:SetToggleKey(Enum.KeyCode.G)

--// TABS
local Main = Window:Tab({ Name = "Auto Arrest", Icon = "shield" })
local Settings = Window:Tab({ Name = "Settings", Icon = "settings" })
local StatsTab = Window:Tab({ Name = "Stats", Icon = "bar-chart" })

--// MAIN TAB
Main:Toggle({
    Name = "ðŸš” AUTO ARREST (MASTER)",
    Default = false,
    Callback = function(v)
        Features.Master = v
        if not v then
            Stats.Target = "None"
        end

        WindUI:Notify({
            Title = "Auto Arrest",
            Content = v and "ONLINE" or "OFFLINE",
            Duration = 3
        })
    end
})

Main:Divider()

Main:Toggle({
    Name = "ðŸŽ¯ Auto Find Criminals",
    Default = true,
    Callback = function(v)
        Features.AutoTarget = v
    end
})

Main:Toggle({
    Name = "ðŸ§² Magnet Follow",
    Default = true,
    Callback = function(v)
        Features.Follow = v
    end
})

Main:Toggle({
    Name = "ðŸ§  Smart Target Switch",
    Default = true,
    Callback = function(v)
        Features.SmartSwitch = v
    end
})

Main:Toggle({
    Name = "ðŸ›¡ï¸ Safe Mode (Anti-Detect)",
    Default = true,
    Callback = function(v)
        Features.SafeMode = v
    end
})

--// SETTINGS TAB
Settings:Slider({
    Name = "Follow Height Offset",
    Min = -10,
    Max = 5,
    Default = -3,
    Callback = function(v)
        _G.AutoArrestSettings.Offset = Vector3.new(0, v, 0)
    end
})

Settings:Slider({
    Name = "Update Speed",
    Min = 0.05,
    Max = 0.3,
    Default = 0.12,
    Callback = function(v)
        _G.AutoArrestSettings.UpdateRate = v
    end
})

--// STATS TAB (STATIC, NO CLEAR)
local arrestsLabel = StatsTab:Label({ Name = "Total Arrests: 0" })
local targetLabel = StatsTab:Label({ Name = "Current Target: None" })
local crimLabel = StatsTab:Label({ Name = "Criminals Online: 0" })

task.spawn(function()
    while task.wait(1) do
        arrestsLabel:Set("Total Arrests: " .. Stats.Arrests)
        targetLabel:Set("Current Target: " .. Stats.Target)
        crimLabel:Set("Criminals Online: " .. Stats.Criminals)
    end
end)

--// MAIN LOOP
task.spawn(function()
    local currentTarget = nil

    while task.wait(_G.AutoArrestSettings.UpdateRate) do
        if not Features.Master then continue end

        -- count criminals
        local count = 0
        for _, p in pairs(Players:GetPlayers()) do
            if isCriminal(p) then
                count += 1
            end
        end
        Stats.Criminals = count

        -- acquire target
        if (not currentTarget or not currentTarget.Character) and Features.AutoTarget then
            currentTarget = getNearestCriminal()
            if currentTarget then
                Stats.Target = currentTarget.Name
            end
        end

        if currentTarget then
            if isArrested(currentTarget) then
                Stats.Arrests += 1
                currentTarget = nil
                Stats.Target = "None"

                if Features.SmartSwitch then
                    task.wait(0.4)
                    currentTarget = getNearestCriminal()
                    if currentTarget then
                        Stats.Target = currentTarget.Name
                    end
                end
            else
                if Features.Follow then
                    followTarget(currentTarget)
                end
            end
        end
    end
end)

WindUI:Notify({
    Title = "Loaded",
    Content = "Advanced Auto Arrest Ready",
    Duration = 5
})

print("âœ… ADVANCED AUTO ARREST LOADED")
